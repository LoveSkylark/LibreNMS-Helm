---
{{- if .Values.enable }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.host.name | quote }}
  namespace: {{ .Release.Name }}
  labels:
{{ include "common.labels" . | indent 4 }}
data:
  CONFIG_RELOAD_INTERVAL: {{ .Values.reloadInterval | quote }}


---
apiVersion: v1
kind: ConfigMap
metadata:
  name: oxidized-file
  namespace: {{ .Release.Name }}
  labels:
{{ include "common.labels" . | indent 4 }}
data:
  config: |-
    model: cisco
    resolve_dns: true
    interval: 72000
    use_syslog: false
    debug: false
    threads: 30
    use_max_threads: false
    timeout: 20
    retries: 3
    prompt: !ruby/regexp /^([\w.@-]+[#>]\s?)$/
    rest: 0.0.0.0:8888  
    next_adds_job: false
    vars: {}
    groups:
      core:
        username: {{ .Values.group.core.user }}
        password: {{ .Values.group.core.password }}
      1:
        username: {{ .Values.group.1.user }}
        password: {{ .Values.group.1.password }}
      2:
        username: {{ .Values.group.2.user }}
        password: {{ .Values.group.2.password }}
      3:
        username: {{ .Values.group.3.user }}
        password: {{ .Values.group.3.password }}
      4:
        username: {{ .Values.group.4.user }}
        password: {{ .Values.group.4.password }}
      5:
        username: {{ .Values.group.5.user }}
        password: {{ .Values.group.5.password }}
      6:
        username: {{ .Values.group.6.user }}
        password: {{ .Values.group.6.password }}
      7:
        username: {{ .Values.group.7.user }}
        password: {{ .Values.group.7.password }}
      8:
        username: {{ .Values.group.8.user }}
        password: {{ .Values.group.8.password }}
      9:
        username: {{ .Values.group.9.user }}
        password: {{ .Values.group.9.password }}
      10:
        username: {{ .Values.group.10.user }}
        password: {{ .Values.group.10.password }}
      11:
        username: {{ .Values.group.11.user }}
        password: {{ .Values.group.11.password }}
      12:
        username: {{ .Values.group.12.user }}
        password: {{ .Values.group.12.password }}
      13:
        username: {{ .Values.group.13.user }}
        password: {{ .Values.group.13.password }}
      14:
        username: {{ .Values.group.14.user }}
        password: {{ .Values.group.14.password }}
      15:
        username: {{ .Values.group.15.user }}
        password: {{ .Values.group.15.password }}
      16:
        username: {{ .Values.group.16.user }}
        password: {{ .Values.group.16.password }}
    models: {}
    model_map:
      juniper: junos
      cisco: ios
      cisco: iosxe
      mikrotik: routeros
      ubiquiti: airos
      fortigate: fortios
      fortiswitch: fortios
   
    pid: "/home/oxidized/.config/oxidized/pid"
    crash:
      directory: "/home/oxidized/.config/oxidized/crashes"
      hostnames: false
    stats:
      history_size: 10
    input:
      default: ssh, telnet
      debug: false
      ssh:
        secure: false
      ftp:
        passive: true
      utf8_encoded: true
    output:
      default: git
      git:
          user: Oxidized
          email: noc@sensa.is
          repo: "/home/oxidized/.config/oxidized/configs"
    source:
      default: http
      debug: false
      http:
        url: http://lnms-app:8000/api/v0/oxidized
        scheme: http
        secure: false
        map:
          name: hostname
          model: os
          group: group
          ip: ip
        headers:
          X-Auth-Token: {{ .Values.credentials.token }}
{{- end }}